#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail

download() {
  declare -r download_type="$1"
  declare -r download_version="$2"
  declare -r download_path="$3"

  rm -rf "$download_path"
  git init "$download_path"
  cd "$download_path"
  cat << EOF > tools.go
// +build tools

package tools

import (
	_ "k8s.io/code-generator/cmd/client-gen"
	_ "k8s.io/code-generator/cmd/conversion-gen"
	_ "k8s.io/code-generator/cmd/defaulter-gen"
	_ "k8s.io/code-generator/cmd/informer-gen"
	_ "k8s.io/code-generator/cmd/lister-gen"
	_ "k8s.io/code-generator/cmd/openapi-gen"
)
EOF
cat << EOF > go.mod
module github.com/jimmidyson/asdf-kube-code-generator

go 1.16

require k8s.io/code-generator v${download_version}
EOF
  go mod tidy
}


download "$ASDF_INSTALL_TYPE" "$ASDF_INSTALL_VERSION" "$ASDF_DOWNLOAD_PATH"